name: vault
base: bare
build-base: ubuntu:22.04
version: "1.15.0"
summary: A ROCK container image for Vault
description: |
  A ROCK container image for Vault, a tool for secrets management, encryption as a service, and privileged access management.
license: Apache-2.0
platforms:
  amd64:

services:
  vault:
    command: vault server -config=/vault/config/config.hcl
    override: replace
    startup: enabled

parts:

  vault:
    plugin: go
    source: https://github.com/hashicorp/vault.git
    source-tag: v1.15.0
    source-type: git
    stage:
      - bin/vault
    build-snaps:
      - go/1.20/stable

  default-config:
    plugin: dump
    source: ./config
    organize:
      config.hcl: /vault/config/config.hcl

  packages:
    plugin: nil
    stage-packages:
      - ca-certificates_data
      - libc6_libs
